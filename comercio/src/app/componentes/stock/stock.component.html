<section id="Stock">
    <div class="container mt-3">
      <h3 id="tituloDeTabla"class="text-center">Historial</h3>
      <div class="stock-body">
        <form [formGroup]="stock">
          <div class="mb-3">
            <datalist id="productos">
                <option selected disabled value="">Seleccione Producto</option>
                <option *ngFor="let item of listaDeProductos" value={{item.nombreProducto}}></option>
            </datalist>
            <label for="tipoDeProducto" class="form-label"
              >Producto</label
            >
            <input
              class="form-select"
              id="tipoDeProducto"
              formControlName="formProducto"
              list="productos"
              (click)="cambiarDatosDeTabla(1)"
              (change)="verificarMarcas()"
            >
          </div>
          <div class="mb-3">
            <label id="cantidad" for="cantidadProducto" class="form-label"
              >Cantidad</label
            >
            <input
              type="number"
              class="form-control"
              id="cantidadProducto"
              formControlName="formCantidad"
              (click)="cambiarDatosDeTabla(1)"
            />
          </div>
          <div class="mb-3">
            <datalist id="marcas">
                <option *ngFor="let item of listaDeMarcas" value={{item}}></option>
            </datalist>
            <label for="Marcas" class="form-label"
              >Marca</label
            >
            <input
              class="form-select"
              id="Marca"
              formControlName="formMarca"
              list="marcas"
              (click)="cambiarDatosDeTabla(1)"
            >
          </div>
          <div class="mb-3">
            <datalist id="proveedores">
                <option *ngFor="let item of listaDeProveedores" value={{item.nombreProveedor}}></option>
            </datalist>
            <label for="Proveedor" class="form-label"
              >Proveedor</label
            >
            <input
              class="form-select"
              id="Proveedor"
              formControlName="formProveedor"
              list="proveedores"
              (click)="cambiarDatosDeTabla(1)"
            >
          </div>
          <div class="mb-3">
            <label for="costo" class="form-label"
              >Costo</label
            >
            <input
              type="number"
              class="form-control"
              id="costo"
              formControlName="formCosto"
              (click)="cambiarDatosDeTabla(1)"
            />
          </div>
          <div class="mb-3">
            <label for="ganancia" class="form-label">Ganancia</label>
            <input
              type="number"
              class="form-control"
              id="ganancia"
              formControlName="formGanancia"
              (click)="cambiarDatosDeTabla(1)"
            />
          </div>
          <div class="mb-3">
            <label for="vencimiento" class="form-label">Vencimiento</label>
            <input
              type="date"
              class="form-control"
              id="vencimiento"
              formControlName="formVencimiento"
              (click)="cambiarDatosDeTabla(1)"
            />
          </div>
          <div class="mb-3">
            <button
            id="btnEscanearProducto"
            type="submit"
            class="btn btn-primary"
            (click)="iniciarScanner()"
            data-bs-toggle="modal"
            data-bs-target="#codeBar2"
          >
          <i class="fa-solid fa-qrcode"></i>
          </button>
          <div class="registros">
          <button
            id="btnAgregarProducto"
            type="submit"
            class="btn btn-primary"
            (click)="agregarStock()"
            data-bs-toggle="modal"
            data-bs-target="#SeleccionarMarcaModal"
          >
          <i class="fa-solid fa-plus"></i>
          </button>
          <button
            id="btnEditarProducto"
            type="submit"
            class="btn btn-warning"
            (click)="editarRegistroSeleccionado() "
          >
          <i class="fa-solid fa-pen-to-square"></i>
          </button>
          <button
            id="btnBorrarProducto"
            type="submit"
            class="btn btn-danger"
            data-bs-toggle="modal"
            data-bs-target="#borrarModal"
          >
          <i class="fa-solid fa-trash-can"></i>
          </button>
          <button
            id="btnLimpiar"
            type="submit"
            class="btn btn-success"
            (click)="resetearModal()"
          >
          <i class="fa-solid fa-arrows-rotate"></i>
          </button>
        </div>
    </div>
          <img *ngIf="!this.imagenValida"id="NopreviewImage" [src]="tempImagen" alt="Vista Previa del Producto no disponible" (change)="verificarImagen()">
          <img *ngIf="this.imagenValida"id="previewImage" [src]="tempImagen" alt="Vista Previa del Producto" (change)="verificarImagen()">
        </form>
        <div id="TablaStock">
          <table *ngIf="stockOHistorial" class="table">
            <thead class="table-dark">
              <th scope="col">ID</th>
              <th scope="col">Producto</th>
              <th scope="col">Cantidad</th>
              <th scope="col">Precio</th>
            </thead>
            <tbody>    
              <tr *ngFor="let item of stockFiltrado">
                <td scope="row" id="CodProd">{{item.codigoProducto}}</td>
                <td scope="row">{{item.nombreProducto}}</td>
                <td scope="row">{{item.cantidadProducto}}</td>
                <td scope="row">${{item.precioProducto}}</td>
              </tr>
            </tbody>
          </table>
          <table *ngIf="!stockOHistorial" class="table">
            <thead class="table-dark">
              <th scope="col">ID</th>
              <th scope="col">Producto</th>
              <th scope="col">Cantidad</th>
              <th scope="col">Marca</th>
              <th scope="col">Proveedor</th>
              <th scope="col">Costo</th>
              <th id="colGanancia"*ngIf="this.opcion" scope="col" (mouseout)="switchOpcion()" (click)=" bloquearOpcion()">Ganancia</th>
              <th id="colPorcentaje"*ngIf="!this.opcion" scope="col" (mouseover)="switchOpcion()">%</th>
              <th scope="col">Ingreso</th>
              <th scope="col">Vencimiento</th>
              <th scope="col">Cod. Barras</th>
            </thead>
            <tbody>    
              <tr *ngFor="let item of listaDeItemsFiltrados" (click)="obtenerDatosSeleccion(item.id)">
                <td scope="row" id="CodProd">{{item.codigoProducto}}</td>
                <td scope="row">{{item.nombreProducto}}</td>
                <td scope="row">{{item.cantidadProducto}}</td>
                <td scope="row">{{item.marcaProducto}}</td>
                <td scope="row">{{item.proveedorProducto}}</td>
                <td scope="row">${{item.costoProducto}}</td>
                <td scope="row"*ngIf="this.opcion">${{item.gananciaProducto}}</td>
                <td scope="row"*ngIf="!this.opcion">{{item.porcentajeProducto}}%</td>
                <td scope="row">{{item.ingresoProducto}}</td>
                <td scope="row">{{item.vencimientoProducto}}</td>
                <td scope="row" id="idCodBar">{{item.barrasProducto}}</td>
              </tr>
            </tbody>
          </table>
          <div class="menuHistorial">
            <div class="seleccion-radio">
              <fieldset>
                <div class="radio">
                  <label id="lblCodigo" for="codigoInput" class="form-label">ID</label>
                <input class="form-check-input" id="codigoInput"type="radio" name="eleccion" checked (click)="SeleccionarFiltro('codigoInput')" hidden>
                </div>
                <span>|</span>
                <div class="radio">
                  <label id="lblProducto" for="productoInput" class="form-label">Producto</label>
                  <input class="form-check-input" id="productoInput"type="radio" name="eleccion" (click)="SeleccionarFiltro('productoInput')"hidden>
                </div>
                <span>|</span>
              <div class="radio">
                <label id="lblFecha" for="fechaInput" class="form-label">Fecha</label>
              <input class="form-check-input" id="fechaInput"type="radio" name="eleccion" (click)="SeleccionarFiltro('fechaInput')"hidden>
              </div>
              </fieldset>
            </div>
            <div class="barra-buscador">
              <form [formGroup]="busqueda" id="formBuscador">
              <label id="lblBuscador" for="buscadorInput" class="form-label">Busqueda</label>
            <input  type="text" class="form-control" id="buscadorInput" formControlName="formBarraDeBusqueda"/>
          </form>
            </div>
            <div class="botones-seleccion">
              <button id="btnRegistro" type="submit" class="btn btn-primary" (click)="cambiarDatosDeTabla(1)"><i class="fa-solid fa-file-circle-question"></i></button>
            <button id="btnStock" type="submit" class="btn btn-secondary" (click)="cambiarDatosDeTabla(2)"><i class="fa-solid fa-dolly"></i></button>
            </div>
            
          </div>
        </div>
    </div>
</div>
</section>

<!--Modal de Lector de Codigo de Barras-->
<div class="modal fade"  id="codeBar2">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5  class="modal-title">Esperando Lectura..</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btnCerrarBarCode2"></button>
      </div>
      <form [formGroup]="lecturaCodeBar">
      <div class="modal-body text-center">
        <input type="text"  class="visually-hidden" id="hiddenCodeBar2" formControlName="formCodeBar" (change)="recuperarRegistro(1)">
        <div  class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </form>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fa-solid fa-ban"></i></button>
        <button type="button" class="btn btn-primary" (click)="desbloquearIngresoManual(1)" data-bs-toggle="modal" data-bs-target="#codeBar3"><i class="fa-solid fa-keyboard"></i></button>
      </div>
    </div>
  </div>
</div>
<!--Modal de Ingreso Manual de Codigo-->
<div class="modal fade"  id="codeBar3">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5  class="modal-title">Ingrese el codigo:</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btnCerrarBarCode3"></button>
      </div>
      <form [formGroup]="lecturaCodeBar">
      <div class="modal-body text-center">
        <input type="text"   id="insertCodeBar2" formControlName="formCodeBar2">
        <button type="button"  id="agreeCodeBar2" class="btn btn-primary" (click)="recuperarRegistro(2)"><i class="fa-solid fa-arrow-right"></i></button>
      </div>
    </form>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fa-solid fa-ban"></i></button>
        <button type="button" class="btn btn-primary"(click)="desbloquearIngresoManual(2)" data-bs-toggle="modal" data-bs-target="#codeBar2"><i class="fa-solid fa-qrcode"></i></button>
      </div>
    </div>
  </div>
</div>
<!--Modal de Confirmacion de Borrado de Producto-->
<div
  class="modal fade"
  id="borrarModal"
  tabindex="-1"
  aria-labelledby="BorrarProducto"
  aria-hidden="true"
><div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="BorrarProducto">
          Confirmar accion
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div style="text-align: center">
          <p>
            Borrar Seleccion?
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button
          id="cerrarModalEliminar"
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
        <i class="fa-solid fa-ban"></i>
        </button>
        <button
          id="btnBorrarRegistroDeProducto"
          type="button"
          class="btn btn-danger"
          (click)="borrarStockSeleccionado()"
        >
        <i class="fa-solid fa-check"></i>
        </button>
      </div>
    </div>
  </div>
</div>